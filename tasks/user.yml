---
- name: Create user for client node builds
  user:
    name: '{{ nimbus_portal_client_user }}'
    group: '{{ nimbus_portal_client_group }}'
    shell: '/bin/bash'

- name: Set disable rebase as merge strategy
  git_config:
    scope: 'global'
    name: 'pull.rebase'
    value: 'false'
  become_user: '{{ nimbus_portal_client_user }}'

- name: Sudoers file to let non-root users start jobs
  template:
    src: 'builds_sudoers.j2'
    dest: '/etc/sudoers.d/80-{{ nimbus_portal_client_service_name }}-builds'
    mode: 0440

- name: Sudoers file for login as nimbus user
  template:
    src: 'nimbus_sudoers.j2'
    dest: '/etc/sudoers.d/81-{{ nimbus_portal_client_service_name }}-login'
    mode: 0440
